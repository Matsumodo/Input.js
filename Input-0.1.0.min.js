(function(){var c={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,L_START:91,R_START:92,L_CMD:91,R_CMD:93,MENU_KEY:93,N_ZERO:96,N_ONE:97,N_TWO:98,N_THREE:99,N_FOUR:100,N_FIVE:101,N_SIX:102,N_SEVEN:103,N_EIGHT:104,N_NINE:105,N_MULTI:106,N_PLUS:107,N_MINUS:109,N_PERIOD:110,N_DEVIDE:111,N_LOCK:144,SEMICOLON:186,EQUAL:187,COMMA:188,MINUS:189,PERIOD:190,SLASH:191,BACKTICK:192,L_BRACKET:219,BACKSLASH:220,R_BRACKT:221,S_QUOTE:222};var b={add:function(j,h){if(j.start==void 0){j.start={}}if(j.start[c[h[0]]]){j.start[c[h[0]]]++}else{j.start[c[h[0]]]=1}var e=h.length;var g,k;for(var f=0;f<e-1;f++){g=c[h[f]];k=c[h[f+1]];if(j[g]==void 0){j[g]={}}if(j[g][k]){j[g][k]++}else{j[g][k]=1}}}};var a={is_string:function(e){return Object.prototype.toString.call(e)==="[object String]"},is_boolean:function(e){return Object.prototype.toString.call(e)==="[object Boolean]"},is_function:function(e){return Object.prototype.toString.call(e)==="[object Function]"},is_undefined:function(e){return e===void 0},is_empty:function(f){if(f==null){return true}if(f.length>0){return false}if(f.length===0){return true}for(var e in f){if(this.hasProp(f,e)){return false}}return true},same_array:function(h,f){if(h.length!==f.length){return false}var e=h.length;for(var g=0;g<e;g++){if(h[g]!==f[g]){return false}}return true},hasProp:function(e,f){return Object.prototype.hasOwnProperty.call(e,f)},string_to_array:function(g){var e=g.toUpperCase().replace(/\s+/g," ").split(" ");for(var f=0;f<e.length;f++){if(e[f]==""){e.splice(f,1)}}return e},string_to_object:function(h){var f={};var j=this.string_to_array(h);var e=j.length;for(var g=0;g<e;g++){if(f[j[g]]){++f[j[g]]}else{f[j[g]]=1}}return f},attach_event:function(e,f,g){if(document.addEventListener){e.addEventListener(f,g)}else{if(document.attachEvent){e.attachEvent("on"+f,g)}}},register_keys:function(g,h){var e=g.length;for(var f=0;f<e;f++){if(c[g[f]]===void 0){throw"Not support "+g[f]}if(h.active_keys[c[g[f]]]){h.active_keys[c[g[f]]]++}else{h.active_keys[c[g[f]]]=1}}},keys_to_keycode:function(j){var f="";var h=string_to_array(j);var e=h.length;for(var g=0;g<e;g++){if(g==e-1){f+=h[g]}else{f=f+h[g]+" "}}return f},make_package:function(f,e,j,i){var g={};var h={};h.order=e;h.callback=j;h.time=i;g[f]=h;return g},store_sizetable:function(f,j){var h=j.size_table;var i="";if(h[f]){var e=h[f].length;var g=h[f][e-1];i=f.toString()+(parseInt(g.substr(1,g.length-1))+1);h[f].push(i)}else{i=f.toString()+1;h[f]=[i]}return i},store_keypackage:function(m,g,l,f,e,h){var j={};if(g){var i=this.string_to_array(m);j.key=i}else{var k=this.string_to_object(m);j.key=k}j.key_origin=m;j.order=g;j.time=f*1000;j.callback=l;j.keep_fire=false;j.count=0;h.keys_package[e]=j},add_to_first:function(f,h,g){var e=g.first_to_id;if(e[f]==void 0){e[f]=[]}e[f].push(h)},add_combo:function(g,k,h,e,j){if(!this.is_string(g)){throw'function(ordered_combo) expects "keys" to be string'}if(!this.is_function(k)){throw'function(ordered_combo) expects "callback" to be function'}var f=this.string_to_array(g);if(this.is_empty(f)){return}this.register_keys(f,j);var i=this.store_sizetable(f.length,j);this.store_keypackage(g,e,k,h,i,j);if(e){this.add_to_first(c[f[0]],i,j);b.add(j.machine,f)}},remove_firstoid:function(g,k,j){var h=j.first_to_id[g];var e=h.length;for(var f=0;f<e;f++){if(h[f]==k){h.splice(f,1);return}}},remove_package:function(j,m){var f=m.keys_package;if(this.is_empty(f)){return false}var l=m.size_table;var h=l[j.length];var e=h.length;var k;for(var g=0;g<e;g++){k=h[g];if(this.same_array(j,f[k].key)){l[j.length].splice(g,1);delete f[k];this.remove_firstoid(c[j[0]],k,m);return true}}return false},remove_activekeys:function(h,j){var g=j.active_keys;var e=h.length;for(var f=0;f<e;f++){if(g[c[h[f]]]==1){delete g[c[h[f]]];continue}g[c[h[f]]]--}},remove_machine:function(j,l){var h=l.machine;var f=j.length;var e,k;e=c[j[0]];if(h.start[e]==1){delete h.start[e]}else{h.start[e]--}for(var g=0;g<f-1;g++){e=c[j[g]];k=c[j[g+1]];if(h[e][k]==1){delete h[e][k]}else{h[e][k]--}}},destroy_combo:function(f,g){var e=this.string_to_array(f);if(this.remove_package(e,g)){this.remove_activekeys(e,g);this.remove_machine(e,g)}},makeup_keyup_obj:function(f,h,g){var e={};e.current=f;e.id=h;e.pass=1;e.v=true;return e},timer:function(f,h,e,g){setTimeout((function(i){return function(){var j=g.keyup_buffer;if(i.is_empty(j)){return}for(var k=0;k<=e;k++){if(i.is_empty(j)){return}if(h==j[k].id){j[k].v=false;return}}}})(this),f)},fire:function(h,k){var f=k.keys_package;var e=h.length;var j;for(var g=0;g<e;g++){j=f[h[g]].callback;f[h[g]].count++;j()}},fire_keydown:function(e,f){},fire_keyup:function(n,m){if(!this.hasProp(m.active_keys,n)){m.keyup_buffer=[];return}var g=m.keyup_buffer;var k=m.keys_package;var q=m.first_to_id;var h=m.machine;var o=[];var p;for(var j=0;j<g.length;j++){p=g[j];if(!p.v){g.splice(j,1);j--;continue}if(this.hasProp(h[p.current],n)){if(p.pass+1==k[p.id].key.length){o.push(p.id);g.splice(j,1);j--}else{p.current=n;p.pass++}}else{g.splice(j,1);j--}}if(this.hasProp(h.start,n)){var e=q[n];var l=e.length;var f;for(var j=0;j<l;j++){if(k[e[j]].key.length==1){o.push(e[j]);continue}f=k[e[j]].time;g.push(this.makeup_keyup_obj(n,e[j],m));if(f){this.timer(f,e[j],j,m)}}}if(o.length>0){this.fire(o,m)}},count:function(o,k){var l=0;var j=k.keys_package;var n=k.size_table;var g=this.string_to_array(o);var e=n[g.length];if(this.is_empty(j)||e==void 0){return l}var m=e.length;var f;for(var h=0;h<m;h++){f=e[h];if(this.same_array(g,j[f].key)){l=j[f].count;return l}}return l}};var d={};d.Listener=(function(){function e(f){this.active_keys={};this.keys_package={};this.size_table={};this.first_to_id={};this.machine={};this.keydown_buffer=[];this.keyup_buffer=[];f=f||document.body;a.attach_event(f,"keyup",(function(g){return function(h){return g.user_input(h,false)}})(this))}e.extend=function(g){for(var f in g){e.prototype[f]=g[f]}};e.extend({unordered_combo:function(f,h,g){a.add_combo(f,h,g,false,this)},ordered_combo:function(f,h,g){a.add_combo(f,h,g,true,this)},delete_combo:function(f){a.destroy_combo(f,this)},user_input:function(g,f){var h=g.keyCode;if(f){a.fire_keydown(h,this)}else{a.fire_keyup(h,this)}},count_times:function(f){return a.count(f,this)},get_keypackage:function(){return this.keys_package},get_sizetable:function(){return this.size_table},get_activekeys:function(){return this.active_keys},get_id:function(){return this.first_to_id},get_machine:function(){return this.machine},get_buffer:function(){return this.keyup_buffer}});return e})();if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=d}else{if(typeof define==="function"&&define.amd){define([],function(){return d})}else{window.Input=d}}})();